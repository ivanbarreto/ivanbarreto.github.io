<!DOCTYPE html>
<html>
<head>
    <style>
        #diagramContainer {
            padding: 20px;
            width:80%; height: 200px;
            border: 1px solid gray;
        }
        
        .item {
            position: absolute;
            height:80px; width: 80px;
            border: 1px solid blue;
            float: left;
        }
        
        .selected {
            border: 2px solid blue;
        }
        
        .port {
            position: absolute;
            height:40px; width: 40px;
            border: 1px solid black;
        }
    </style>
</head>
<body>

    <button onclick="port('and')">AND</button>
    <div id="diagramContainer">
        <div id="rubberband" style="border:1px solid green;display:none;"></div>
        
        <div id="item_left" class="item"></div>
        <div id="item_right" class="item" style="left:150px;"></div>
        
    </div>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jqueryui/1.9.2/jquery-ui.min.js"></script>
    <script src="http://www.freedevelopertutorials.com/statics/dom.jsPlumb-1.7.5-min.js"></script>
    
    <script>
        jsPlumb.ready(function() {
        
        var startPoint = {};
        var rubberbandDrawingActive = false;
        var selection = 'and';
        var diagram = $('#diagramContainer');
        var increasingnumber = 0;
        var tempnum = 0;
        var firstInstance = jsPlumb.getInstance();
        
        function generatedid(){
            increasingnumber = increasingnumber+1;
            tempnum = increasingnumber -1;
            return (tempnum).toString();    
        }
        
        function diagramContainer_MouseDown(event) {
            startPoint.x = event.pageX;         
            startPoint.y = event.pageY;
            
            $("#rubberband").css({top:startPoint.y, left:startPoint.x, height:1, width:1, position:'absolute'});
            $("#rubberband").show();
        }
        
        function diagramContainer_MouseMove(event) {
            if($("#rubberband").is(":visible") !== true) { return; }
            
            var t = (event.pageY > startPoint.y) ? startPoint.y : event.pageY;
            var l = (event.pageX >= startPoint.x) ? startPoint.x : event.pageX;
            
            wcalc = event.pageX - startPoint.x;
            var w = (event.pageX > startPoint.x) ? wcalc : (wcalc * -1); 
            
            hcalc = event.pageY - startPoint.y;
            var h = (event.pageY > startPoint.y) ? hcalc : (hcalc * -1); 
            
            $("#rubberband").css({top:t, left:l, height:h, width:w, position:'absolute'});
        }
        
        function diagramContainer_MouseUp(event) {
            diagramContainer_FindSelectedItem();
            $("#rubberband").hide();
        }
        
        function diagramContainer_FindSelectedItem() {
            if($("#rubberband").is(":visible") !== true) { return; }
            
            var rubberbandOffset = getTopLeftOffset($("#rubberband"));
            $(".item").each(function() {
                var itemOffset = getTopLeftOffset($(this));
                if( itemOffset.top > rubberbandOffset.top &&
                    itemOffset.left > rubberbandOffset.left &&
                    itemOffset.right < rubberbandOffset.right &&
                    itemOffset.bottom < rubberbandOffset.bottom) {
                    $(this).addClass("selected");
                    var elementid = $(this).attr('id');
                    jsPlumb.addToDragSelection(elementid);
                }
            });
        }
        
        function getTopLeftOffset(element) {
            var elementDimension = {};
            elementDimension.left = element.offset().left;
            elementDimension.top =  element.offset().top;
            elementDimension.right = elementDimension.left + element.outerWidth();
            elementDimension.bottom = elementDimension.top + element.outerHeight();
            
            return elementDimension;
        }
        
        function diagramContainer_Click(event) {
            if(startPoint.x === event.pageX && startPoint.y === event.pageY)
            {
                jsPlumb.clearDragSelection();
                $(".item").each(function() {
                    $(this).removeClass("selected");
                });
            }
        }
        
        function diagramContainer_dblClick(event) {
            var parentOffset = diagram.parent().offset(); 
           //or $(this).offset(); if you really just want the current element's offset
           var relX = event.pageX - parentOffset.left;
           var relY = event.pageY - parentOffset.top;
                  
            
            switch(selection) {
            case 'and':
                alert(diagram);
                var port_and = '<div id="and'+generatedid(increasingnumber)+'" class="port and"></div>';
                diagram.append(port_and).css({
            left: relX,
            top: relY
            });
            jsPlumb.draggable($(".port"));
                break;
            }
            
        }
            
            $("#diagramContainer").mousedown(diagramContainer_MouseDown);
            $("#diagramContainer").mousemove(diagramContainer_MouseMove);
            $("#diagramContainer").mouseup(diagramContainer_MouseUp);
            $("#diagramContainer").click(diagramContainer_Click);
            $("#diagramContainer").dblclick(diagramContainer_dblClick);
            
            jsPlumb.connect({
                source:"item_left",
                target:"item_right",
                endpoint:"Rectangle"
            });
            jsPlumb.draggable("item_left");
            jsPlumb.draggable("item_right");
        });
    </script> 

</body>
</html>
