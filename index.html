<!DOCTYPE html>
<html>
<head>
    <style>
        #diagramContainer {
            padding: 20px;
            width:80%; height: 200px;
            border: 1px solid gray;
        }
        
        .selected {
            border: 2px solid blue;
        }

        .port {
            position: absolute;
            height:80px; width: 80px;
            border: 1px solid black;
            float: left;
        }

        .led {
            border-radius: 50%;
            position: absolute;
            width: 80px; height: 80px;
            background: solid red;
            border: 5px solid black;
            float: left;
        }

        .power {
            position: absolute;
            height:80px; width: 80px;
            float: left;
            display: table-cell;
            text-align: center;
            vertical-align: middle;
            overflow:auto;
            background-color: solid red;
            border: 5px solid black;
            font-family: sans-serif;
            text-decoration: none;
            font-weight: bold;
        }

        .powertext {
            display: table-cell;
            vertical-align:middle;
            text-align:center;
            color: #FFFFFF;
            text-decoration: none;
        }

    </style>
</head>
<script src="js/jquery-3.1.1.min.js"></script>
    <script src="js/jquery-ui.min.js"></script>
    <script src="js/jsPlumb-2.1.7.js"></script>
    
    <script>

        var selection = 'and';
        function select(a){
            selection = a;
        }


        jsPlumb.ready(function() {
        
        var startPoint = {};
        var rubberbandDrawingActive = false;
        var diagram = $('#diagramContainer');
        var tempnum = 0;
        var firstInstance = jsPlumb.getInstance();
        var commonsource = {
            isSource:true,
            isTarget:false,
            connector: ["Straight"]
            };
        var commontarget = {
            isSource:false,
            isTarget:true,
            connector: ["Straight"]
            };
        var elements = {}
            elements.and = 0;
            elements.nand = 0;
            elements.not = 0;
            elements.or = 0;
            elements.nor = 0;
            elements.xor = 0;
            elements.xnor = 0;
            elements.led = 0;
            elements.power = 0;


        function generatedid(){
            var tempnum = 0;
            switch(selection) {
                case 'and': 
                elements.and = elements.and+1;
                tempnum = elements.and-1;
                break;
                case 'nand':
                elements.nand = elements.nand+1;
                tempnum = elements.nand-1;
                break;
                case 'not':
                elements.not = elements.not+1;
                tempnum = elements.not-1;
                break;
                case 'or':
                elements.or = elements.or+1;
                tempnum = elements.or-1;
                break;
                case 'nor':
                elements.nor = elements.nor+1;
                tempnum = elements.nor-1;
                break;
                case 'xor':
                elements.xor = elements.xor+1;
                tempnum = elements.xor-1;
                break;
                case 'xnor':
                elements.xnor = elements.xnor+1;
                tempnum = elements.xnor-1;
                break;
                case 'led':
                elements.led = elements.led+1;
                tempnum = elements.led-1;
                break;
                case 'power':
                elements.power = elements.power+1;
                tempnum = elements.power-1;
                break;     
                }
            return (tempnum).toString();   
        }

        
        function createelement(x,y){
            var id = selection+generatedid();
            var port = '<div id="'+id+'" class="'+selection+' port"></div>';
                diagram.append(port).css({
                left: x,
                top: y
            });
            jsPlumb.draggable($("#"+id));
            if(selection == 'and' || 
                selection == 'nand' || 
                selection == 'or' || 
                selection == 'nor' || 
                selection == 'xor' || 
                selection == 'xnor'){
                //$("#"+id).addClass("port");
                jsPlumb.addEndpoint($("#"+id), {
                    anchors:["Right"]
                }, commonsource);
                jsPlumb.addEndpoint($("#"+id), {
                    anchors:["BottomLeft"]
                }, commontarget);
                
                jsPlumb.addEndpoint($("#"+id), {
                    anchors:["TopLeft"]
                }, commontarget);   
            }
            else if(selection == 'not'){
                jsPlumb.addEndpoint($("#"+id), {
                    anchors:["Right"]
                }, commonsource); 
                jsPlumb.addEndpoint($("#"+id), {
                    anchors:["Left"]
                }, commontarget);      
            }
            
            else if(selection == 'led'){
                jsPlumb.addEndpoint($("#"+id), {
                    anchors:["Left"]
                }, commontarget);    
            }
            else if(selection == 'power'){
                ($("#"+id)).text("OFF");
                jsPlumb.addEndpoint($("#"+id), {
                    anchors:["Right"]
                }, commonsource);
                var startPoint = [];
                ($( "#"+id)).mousedown(function() {
                    startPoint.x = event.pageX;         
                    startPoint.y = event.pageY;
                });
                ($("#"+id)).mouseup(function() {
                        if(startPoint.x === event.pageX && startPoint.y === event.pageY){
                            if(($("#"+id)).text() == "OFF"){
                                ($("#"+id)).text("ON");
                            }
                            else if(($("#"+id)).text() == "ON"){
                                ($("#"+id)).text("OFF");
                            }
                        } 
                    });
                };
            }

        function diagramContainer_MouseDown(event) {
            startPoint.x = event.pageX;         
            startPoint.y = event.pageY;
            
            $("#rubberband").css({top:startPoint.y, left:startPoint.x, height:1, width:1, position:'absolute'});
            $("#rubberband").show();
        }
        
        function diagramContainer_MouseMove(event) {
            if($("#rubberband").is(":visible") !== true) { return; }
            
            var t = (event.pageY > startPoint.y) ? startPoint.y : event.pageY;
            var l = (event.pageX >= startPoint.x) ? startPoint.x : event.pageX;
            
            wcalc = event.pageX - startPoint.x;
            var w = (event.pageX > startPoint.x) ? wcalc : (wcalc * -1); 
            
            hcalc = event.pageY - startPoint.y;
            var h = (event.pageY > startPoint.y) ? hcalc : (hcalc * -1); 
            
            $("#rubberband").css({top:t, left:l, height:h, width:w, position:'absolute'});
        }
        
        function diagramContainer_MouseUp(event) {
            diagramContainer_FindSelectedItem();
            $("#rubberband").hide();
        }
        
        function diagramContainer_FindSelectedItem() {
            if($("#rubberband").is(":visible") !== true) { return; }
            
            var rubberbandOffset = getTopLeftOffset($("#rubberband"));
            $(".item").each(function() {
                var itemOffset = getTopLeftOffset($(this));
                if( itemOffset.top > rubberbandOffset.top &&
                    itemOffset.left > rubberbandOffset.left &&
                    itemOffset.right < rubberbandOffset.right &&
                    itemOffset.bottom < rubberbandOffset.bottom) {
                    $(this).addClass("selected");
                    var elementid = $(this).attr('id');
                    jsPlumb.addToDragSelection(elementid);
                }
            });
        }
        
        function getTopLeftOffset(element) {
            var elementDimension = {};
            elementDimension.left = element.offset().left;
            elementDimension.top =  element.offset().top;
            elementDimension.right = elementDimension.left + element.outerWidth();
            elementDimension.bottom = elementDimension.top + element.outerHeight();
            
            return elementDimension;
        }
        
        function diagramContainer_Click(event) {
            if(startPoint.x === event.pageX && startPoint.y === event.pageY)
            {
                jsPlumb.clearDragSelection();
                $(".item").each(function() {
                    $(this).removeClass("selected");
                });
            }
        }
        
        function diagramContainer_dblClick(event) {
            var x = event.pageX;
            var y = event.pageY;
            createelement(x,y);
        }
            
            $("#diagramContainer").mousedown(diagramContainer_MouseDown);
            $("#diagramContainer").mousemove(diagramContainer_MouseMove);
            $("#diagramContainer").mouseup(diagramContainer_MouseUp);
            $("#diagramContainer").click(diagramContainer_Click);
            $("#diagramContainer").dblclick(diagramContainer_dblClick);
        });
    </script> 


<body>

    <button onclick="select('and')">AND</button>
    <button onclick="select('nand')">NAND</button>
    <button onclick="select('not')">NOT</button>
    <button onclick="select('or')">OR</button>
    <button onclick="select('nor')">NOR</button>
    <button onclick="select('xor')">XOR</button>
    <button onclick="select('xnor')">XNOR</button>
    <button onclick="select('led')">LED</button>
    <button onclick="select('power')">POWER</button>
    <div id="diagramContainer">
        <div id="rubberband" style="border:1px solid green;display:none;"></div>     
        
    </div>

</body>
</html>
